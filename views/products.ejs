<div class="container py-5">
    <h2 class="text-center mb-4">Our Products</h2>
    <div class="row">
        <% products.forEach((item, index) => { %>
            <div class="col-12 col-sm-6 col-md-4 col-lg-4 mb-4">
                <div class="card product-card">
                    <img src="/uploads/<%= item.ProImage %>" class="card-img-top product-img" alt="Product">
                    <div class="card-body">
                        <h2 class="card-title fs-5"><%= item.title.slice(0,30) %>...</h2>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                                <span class="price">₹ <%= item.price %></span>
                                <span class="original-price ms-2">₹ <%= item.originalPrice %></span>
                            </div>
                        </div>
                        <div class="d-grid gap-2">
                            <a href="/buyNow/<%= item.id %>" class="btn btn-primary buy-now-btn" data-product-index="<%= index %>">Buy Now</a>
                            <button class="btn btn-outline-secondary details-btn" 
                                    data-bs-toggle="modal" 
                                    data-bs-target="#productModal" 
                                    data-product-index="<%= index %>">
                                More Details
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        <% }) %>
    </div>
</div>

<!-- Product Details Modal -->
<div class="modal fade myPopUp" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="productModalLabel"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <img id="modalProductImage" src="" class="img-fluid rounded" alt="Product Image">
                    </div>
                    <div class="col-md-6">
                        <h2 id="modalProductTitle"></h2>
                        <div class="mb-3">
                            <span class="price fs-4" id="modalProductPrice"></span>
                            <span class="original-price ms-2" id="modalProductOriginalPrice"></span>
                        </div>
                        <p id="modalProductDescription" class="mb-4"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap 5 JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const productsData = <%- JSON.stringify(products) %>;

    document.querySelectorAll('.details-btn').forEach(button => {
        button.addEventListener('click', function () {
            const index = this.getAttribute('data-product-index');
            const product = productsData[index];

            document.getElementById('productModalLabel').innerText = product.title;
            document.getElementById('modalProductImage').src = "/uploads/" + product.ProImage;
            document.getElementById('modalProductTitle').innerText = product.title;
            document.getElementById('modalProductPrice').innerText = "₹ " + product.price;
            document.getElementById('modalProductOriginalPrice').innerText = "₹ " + product.originalPrice;
            document.getElementById('modalProductDescription').innerText = product.description || "No description available";

            // Modal ke Buy Now Button ko product index do
            document.getElementById('modalBuyNowBtn').setAttribute("data-product-index", index);
        });
    });


    // Modal ke andar Buy Now Button
    document.getElementById('modalBuyNowBtn').addEventListener('click', function () {
        const index = this.getAttribute('data-product-index');
        const product = productsData[index];
        alert(`Added ${product.title} to your cart!\nPrice: ₹${product.price}`);

        // Modal close karo
        const modal = bootstrap.Modal.getInstance(document.getElementById('productModal'));
        modal.hide();
    });
</script>
